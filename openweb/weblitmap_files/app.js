angular.module("webmakerApp",["ngRoute","ui.bootstrap","webmakerApp.services","ngWebmakerLogin","localization","ngScrollSpy","angularMoment","wmMakeApiAngular","markdown"]).config(["$compileProvider","$routeProvider","$locationProvider","makeApiProvider","CONFIG",function($compileProvider,$routeProvider,$locationProvider,makeApiProvider,CONFIG){$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|javascript):/),makeApiProvider.options.apiURL=CONFIG.makeApiUrl,$routeProvider.when("/:locale/about",{templateUrl:"/views/explore.html",controller:"exploreController",title:"Explore"}).when("/:locale/resources/literacy/:id",{templateUrl:"/views/competency.html",controller:"competencyController"}).when("/:locale/remix-your-school",{templateUrl:"/views/remix-your-school.html",title:"Remix Your School"}).when("/:locale/music-video",{templateUrl:"/views/music-video.html",title:"Music Video"}).when("/:locale/private-eye",{templateUrl:"/views/private-eye.html",title:"Private Eye"}).when("/:locale/resources",{templateUrl:"/views/resources.html",controller:"resourcesHomeController",title:"Resources"}).when("/:locale/mentor",{templateUrl:"/views/mentor.html",controller:"mentorController",title:"Mentor"}).when("/:locale/literacy",{templateUrl:"/views/literacy.html",controller:"literacyController",title:"WebLiteracyMap"}).when("/:locale/tools",{templateUrl:"/views/tools.html",controller:"toolsController",title:"Tools"}).when("/:locale/madewithcode-:mwc",{templateUrl:"/views/madewithcode.html",controller:"mwcController",title:"Made with Code"}).when("/:locale/admin/badges",{templateUrl:"/views/admin/badges-main.html",controller:"badgesAdminController",title:"Badges Admin"}).when("/:locale/admin/create-badge",{templateUrl:"/views/admin/create-update-badge.html",controller:"createUpdateBadgeController",title:"Create a Badge"}).when("/:locale/admin/badges/:badge/update",{templateUrl:"/views/admin/create-update-badge.html",controller:"createUpdateBadgeController",title:"Update a Badge"}).when("/:locale/admin/badges/:badge",{templateUrl:"/views/admin/badges-badge.html",controller:"badgesAdminBadgeController",title:"Badges Admin"}).when("/:locale/signup/:auth?",{templateUrl:"/views/signup.html",controller:"homeController",title:"Webmaker - Sign Up"}).when("/:locale/appmaker",{templateUrl:"/views/appmaker.html",controller:"appmakerController",title:"Discover Appmaker"}).when("/:locale/goggles",{templateUrl:"/views/goggles.html",controller:"gogglesController",title:"The X-Ray Goggles"}).when("/:locale/goggles/install",{templateUrl:"/views/install-goggles.html",controller:"gogglesController",title:"Install the X-Ray Goggles"}).when("/:locale/make-your-own",{templateUrl:"/views/make-your-own.html",controller:"makeYourOwnController",title:"TeachTemplates"}).when("/:locale/feedback",{templateUrl:"/views/feedback.html",controller:"feedbackController",title:"Feedback"}).when("/:locale/getinvolved",{templateUrl:"/views/getinvolved.html",controller:"getinvolvedController",title:"Get Involved"}).when("/:locale/privacy",{templateUrl:"/views/privacy.html",controller:"homeController",title:"Privacy Policy"}).when("/:locale/terms",{templateUrl:"/views/terms.html",controller:"homeController",title:"Terms of Use"}).when("/:locale",{templateUrl:"/views/home-3.html",controller:"homeController",title:"Webmaker"}).when("/:locale/home-:variant",{templateUrl:function(params){return"/views/home-"+params.variant+".html"},controller:"homeController",title:"Webmaker"}).otherwise({redirectTo:"/:locale"}),$locationProvider.html5Mode(!0),$locationProvider.hashPrefix("!")}]).run(["$rootScope","$http","$routeParams","$location","CONFIG","weblit",function($rootScope,$http,$routeParams,$location,CONFIG){function forceLocale(){var matchesLang,href=$location.path(),matches=href.match(/([a-z]{2,3})([-]([a-zA-Z]{2}))?/);if(matches&&(matchesLang=matches[1]&&matches[2]?matches[1].toLowerCase()+matches[2].toUpperCase():matches[1].toLowerCase()),matches&&matches[0]&&-1===CONFIG.supported_languages.indexOf(matchesLang))$location.path(CONFIG.lang+href);else{if(matches&&matches[0]&&-1!==CONFIG.supported_languages.indexOf(matchesLang))return;$location.path(CONFIG.lang+href)}}$rootScope.title="Webmaker",$rootScope.lang=CONFIG.supported_languages.indexOf(CONFIG.lang)>0?CONFIG.lang:CONFIG.defaultLang,$rootScope.baseUrl="/"+$rootScope.lang+"/",$rootScope.direction=CONFIG.direction,$rootScope.arrowDir="rtl"===CONFIG.direction?"left":"right",$rootScope.languages=CONFIG.supported_languages,$rootScope.currentPath=$location.path(),$http.defaults.headers.common["X-CSRF-Token"]=CONFIG.csrf,$rootScope.$on("$routeChangeSuccess",function(e,current){$rootScope.title=current.$$route&&current.$$route.title||"Webmaker",forceLocale()}),$http.get("/data/content.json").success(function(data){$rootScope.allContent=data,$rootScope.contentReady=!0}).error(function(err){console.log(err)}),$http.get("/data/madewithcode.json").success(function(data){$rootScope.madewithcode=data,$rootScope.mwcReady=!0}).error(function(err){console.log(err)}),forceLocale()}]),angular.module("webmakerApp").controller("navigationController",["$scope","$location","$routeParams","$rootScope","weblit","wmNav","CONFIG",function($scope,$location,$routeParams,$rootScope,weblit,wmNav,config){$scope.nav=wmNav.nav,$scope.accountSettingsUrl=config.accountSettingsUrl,$scope.eventsUrl=config.eventsUrl,$scope.teachUrl=config.teachUrl,$scope.primaryCollapse=!0,$scope.secondaryCollapse=!0,$scope.tertiaryCollapse=!0,$scope.mobileCollapse=!0,$scope.collapseToggle=function(){$scope.primaryCollapse=!$scope.primaryCollapse,$scope.secondaryCollapse=!$scope.secondaryCollapse,$scope.tertiaryCollapse=!$scope.tertiaryCollapse},$scope.weblitToggle=function(){$scope.mobileCollapse=!$scope.mobileCollapse},$rootScope.$on("$locationChangeSuccess",function(){$scope.primaryCollapse=!0,$scope.secondaryCollapse=!0,$scope.tertiaryCollapse=!0,$scope.mobileCollapse=!0}),$scope.clickedResource=!1,$scope.literacies=weblit.all(),$scope.page=wmNav.page,$scope.section=wmNav.section,$scope.isActivePage=function(page){return page===wmNav.page()},$scope.isActiveSection=function(section){return section===wmNav.section()},$scope.search=function(input){window.location="/"+config.lang+"/search?type=all&q="+input}}]).controller("exploreController",["$scope","CONFIG",function($scope,CONFIG){$scope.eventsUrl=CONFIG.eventsUrl,$scope.contributeBoxes=[{icon:"book",title:"Teaching kits",description:"Teaching kits desc",target:"/"+CONFIG.lang+"/make-your-own"},{icon:"map-marker",title:"Events",description:"Events desc",target:"https://events.webmaker.org/"+CONFIG.lang},{icon:"globe",title:"Translate",description:"Translate desc",target:"https://support.mozilla.org/"+CONFIG.lang+"/kb/translate-webmaker"},{icon:"picture-o",title:"Design",description:"Design desc",target:"https://wiki.mozilla.org/Webmaker/Design"},{icon:"code",title:"Code",description:"Code desc",target:"https://support.mozilla.org/"+CONFIG.lang+"/kb/contribute-webmaker-code"},{icon:"rocket",title:"Partner",description:"Partner desc",target:"http://party.webmaker.org/"+CONFIG.lang+"/partners"}]}]).controller("homeController",["$rootScope","$scope","wmNav","$routeParams","localize","CONFIG",function($rootScope,$scope,wmNav,$routeParams,localize){function onboardingExperience(){function setFontSize(){publishedText.css("font-size",publishedText.height()+"em")}function cancelAutoInput(){clearTimeout(timeout),$(".onboarding-tooltip-container").removeClass("fade-in")}function inputTextCharacter(){input.val(input.val()+inputText[currentLength++]),currentLength<inputText.length&&(timeout=setTimeout(inputTextCharacter,200))}$("#home-start-form").on("submit",function(){$rootScope.joinWebmaker($(".home-email-field").val(),"",$("#onboarding-checkbox").prop("checked"))});var timeout,input=$(".onboarding-input"),inputText=localize.getLocalizedString("sharing"),currentLength=0,publishedText=$(".onboarding-published-text");$(window).resize(setFontSize),$(".onboarding-next-button").click(function(){var text=input.val();$(".onboarding-step-1").addClass("hidden"),$(".onboarding-step-2").removeClass("hidden"),$(".home-panel").addClass("home-blue"),$(".home-panel").removeClass("home-green"),text&&(setFontSize(),publishedText.text(text))}),input.click(function(){input[0].setSelectionRange(0,input.val().length),cancelAutoInput()}),input.on("input",cancelAutoInput),input.on("blur",function(){$(".onboarding-tooltip-container").addClass("fade-in")}),input.focus(),timeout=setTimeout(inputTextCharacter,2e3)}function measureThings(){rectangle=document.getElementById("iris-pupil").getBoundingClientRect(),center={x:rectangle.width/2+rectangle.left,y:rectangle.height/2+rectangle.top}}function doMaths(x,y,radius){var pythagoras=Math.sqrt(Math.pow(x,2)+Math.pow(y,2)),coordinates={x:x,y:y};return 0!==pythagoras&&(coordinates.x=x*radius/pythagoras,coordinates.y=y*radius/pythagoras),coordinates}function translatePupil(coords){document.getElementById("iris-pupil").setAttribute("transform","translate("+coords.x+", "+coords.y+")")}function checkMovement(){var nowTime=Date.now(),diffTime=(nowTime-mousemoveTime)/1e3;diffTime>3&&(eyeSVG.classList.remove("show"),eyeGif.classList.remove("hide")),setTimeout(checkMovement,1e3)}wmNav.page("home"),wmNav.section(""),$scope.userDel=$routeParams.userDel,"login"===$routeParams.auth?$rootScope.wmTokenLogin():"new-account"===$routeParams.auth&&$rootScope.wmCreateUser(),"6"===$routeParams.variant?localize.resourceFileLoaded?onboardingExperience():$rootScope.$on("localizeResourcesUpdated",onboardingExperience):$("#home-start-form").on("submit",function(){$rootScope.joinWebmaker($(".home-email-field").val())});var rectangle,center,radius=9,mousemoveTime=Date.now(),eyeGif=document.querySelector(".privacy-gif"),eyeSVG=document.querySelector(".privacy-svg");checkMovement(),document.getElementById("iris-pupil")&&(window.onmousemove=function(e){mousemoveTime=Date.now(),eyeSVG.classList.add("show"),eyeGif.classList.add("hide"),measureThings(),translatePupil(doMaths(e.pageX-center.x,e.pageY-center.y,radius))})}]).controller("competencyController",["$rootScope","$scope","$routeParams","weblit","CONFIG","$timeout","wmNav",function($rootScope,$scope,$routeParams,weblit,CONFIG,$timeout,wmNav){wmNav.page($routeParams.id),wmNav.section("resources"),$scope.tag=$routeParams.id,$scope.skill=weblit.all().filter(function(item){return item.tag===$scope.tag})[0],$rootScope.contentReady?$scope.content=$rootScope.allContent[$scope.tag]:$timeout(function(){$scope.content=$rootScope.allContent[$scope.tag]},500),$scope.weblit=weblit,$scope.wlcPoints=CONFIG.wlcPoints}]).controller("competencyMediaGenController",["$scope","$sce",function($scope,$sce){function safeUrl(media){switch(media.type){case"youtube":return $sce.trustAsResourceUrl("https://www.youtube-nocookie.com/embed/"+media.content+"?enablejsapi=1&amp;wmode=transparent&amp;autohide=1&amp;autoplay=0&amp;rel=0&amp;fs=1&amp;hd=1&amp;rel=0&amp;showinfo=0&amp;start=&amp;theme=dark");case"vimeo":return $sce.trustAsResourceUrl("https://player.vimeo.com/video/"+media.content+"?title=0&amp;byline=0&amp;portrait=0&amp;color=eb6933");case"ted":return $sce.trustAsResourceUrl("https://embed-ssl.ted.com/talks/"+media.content+".html");case"popcorn":return $sce.trustAsResourceUrl(media.content);default:return media.content}}$scope.safeUrl=safeUrl}]).controller("resourceFormController",["$scope","$http","wmAnalytics",function($scope,$http,analytics){$scope.formData={},$scope.submit=function(){var data=$scope.formData;data.username=$scope._user.username,data.email=$scope._user.email,data.webliteracy=$scope.skill.term,$http.post("/api/submit-resource",data).success(function(ok){ok&&($scope.success=!0,$scope.formData={},analytics.event("Suggested Web Literacy Resource"))}).error(function(err){console.log(err)})}}]).controller("resourcesHomeController",["$scope","weblit","wmNav",function($scope,weblit,wmNav){wmNav.page("resources"),wmNav.section("teach"),$scope.literacies=weblit.all()}]).controller("literacyController",["$scope","weblit","wmNav","CONFIG",function($scope,weblit,wmNav,CONFIG){wmNav.section("resources"),wmNav.page("literacy"),$scope.litMapTitle=weblit.title()+" - "+weblit.version,$scope.strands=weblit.strands(),$scope.litMap=weblit.allByStrand(),$scope.wlcPoints=CONFIG.wlcPoints}]).controller("toolsController",["$scope","wmNav",function($scope,wmNav){wmNav.page("tools"),wmNav.section("tools")}]).controller("makeYourOwnController",["$rootScope","$scope","$timeout","wmNav","CONFIG",function($rootScope,$scope,$timeout,wmNav,CONFIG){function init(){$scope.userId=$rootScope._user.id,$scope.direction=CONFIG.direction}wmNav.section("resources"),wmNav.page("make-your-own"),$rootScope._user?init():$timeout(function(){init()},500)}]).controller("mwcController",["$rootScope","$scope","$routeParams","$timeout","wmNav",function($rootScope,$scope,$routeParams,$timeout,wmNav){function init(){$scope.madewithcode=$rootScope.madewithcode[$scope.page],$scope.userId=$rootScope._user.id}wmNav.section("resources"),wmNav.page(""),$scope.page=$routeParams.mwc,$rootScope._user?init():$timeout(function(){init()},500)}]).controller("badgesAdminController",["$rootScope","$scope","$http","wmNav",function($rootScope,$scope,$http,wmNav){wmNav.page("badges-admin"),wmNav.section("explore"),$scope.badges=[],$scope.reverse=!1,$scope.predicate="created",$scope.hasPermissions=function(badge){return window.badgesPermissionsModel({badge:badge,user:$rootScope._user,action:"applications"})},$http.get("/api/badges").success(function(badges){$scope.badges=badges})}]).controller("createUpdateBadgeController",["$rootScope","$scope","$http","$routeParams","$location","wmNav","CONFIG",function($rootScope,$scope,$http,$routeParams,$location,wmNav,config){function prepareBadge(data){var badge=angular.copy(data);return badge.consumerDescription=data.earnerDescription,badge.criteriaUrl="https://webmaker.org/badges/"+badge.slug,badge.unique=0,badge.type="Skill",badge.tags?badge.tags=data.tags.split(/[\s,]+/).filter(function(item){return item}):delete badge.tags,badge.criteria=data.criteria.map(function(criterion){return criterion.required=1,criterion}),badge}wmNav.page("create-badge"),wmNav.section("explore"),$scope.view=$routeParams.badge?"update":"create",$scope.title=$routeParams.badge?"Update Badge":"Create a New Badge","update"===$scope.view?$http.get("/api/badges/"+$routeParams.badge).success(function(data){data.tags=data.tags.map(function(obj){return obj.value}).join(", "),$scope.badge=data}).error(function(err){console.log(err)}):$scope.badge={criteria:[{description:"# This is an example\n* point 1\n* point 2\n* point 3"}]},$scope.hasError=function(formEl){return{"has-error":($scope.submitAttempt||formEl.$dirty)&&formEl.$invalid}},$scope.criteriaPreview=function(){if(!$scope.badge||!$scope.badge.criteria)return"";var result=$scope.badge.criteria.map(function(item){return item.description}).join("\n\n");return result},$scope.addCriterion=function(){$scope.badge.criteria.push({description:""})},$scope.removeCriterion=function(index){$scope.badge.criteria.splice(index,1)},$scope.submit=function(isValid,badge){if($scope.submitAttempt=!0,isValid){var url="/api/badges/"+($routeParams.badge?$routeParams.badge+"/"+$scope.view:"create");badge=prepareBadge(badge),console.log("Sending...",badge),$http.post(url,badge).success(function(data){console.log("Success!",data),window.location="/"+config.lang+"/badges/"+data.slug}).error(function(err){console.log(err)})}}}]).controller("badgesAdminBadgeController",["$scope","$http","$window","$routeParams","$modal","wmNav",function($scope,$http,$window,$routeParams,$modal,wmNav){function onError(err){$scope.badgesError=err.error,console.log(err)}function createReviewItems(decision){var criteria=$scope.badge.criteria,reviewItems=[],satisfied="yes"===decision;return criteria.forEach(function(item){reviewItems.push({criterionId:item.id,satisfied:satisfied,comment:""})}),reviewItems}wmNav.page("badges-admin"),wmNav.section("explore");var currentBadge=$routeParams.badge;$scope.badge={},$scope.instances=[],$scope.badgesError=!1,$scope.issueBadges=function(emailString,comment){var emails=emailString.split(/[,;\n ]+/);$http.post("/api/badges/"+currentBadge+"/issue",{emails:emails,comment:comment}).success(function(data){$scope.badgesError=!1,$scope.instances=data.concat($scope.instances),$scope.issueComment="",$scope.issueEmails=""}).error(onError)},$scope.revokeBadge=function(email){var ok=$window.confirm("Are you sure you want to delete "+email+"'s badge?");ok&&$http["delete"]("/api/badges/"+currentBadge+"/instance/email/"+email).success(function(){for(var i=0;i<$scope.instances.length;i++)$scope.instances[i].email===email&&$scope.instances.splice(i,1)}).error(onError)},$scope.reviewApplication=function(application){$modal.open({templateUrl:"/views/partials/review-application-modal.html",resolve:{application:function(){return application}},controller:ReviewApplicationController}).result.then(function(review){$http.post("/api/badges/"+currentBadge+"/applications/"+review.id+"/review",{comment:review.comment,reviewItems:createReviewItems(review.decision)}).success(function(){for(var i=0;i<$scope.applications.length;i++)$scope.applications[i].slug===review.id&&$scope.applications.splice(i,1)}).error(onError)})};var ReviewApplicationController=function($scope,$modalInstance,application){$scope.review={id:application.slug,email:application.learner},$scope.application=application,$scope.ok=function(){$modalInstance.close($scope.review)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}};$http.get("/api/badges/"+currentBadge+"/instances").success(function(data){$scope.instances=data.instances,$scope.badge=data.badge}).error(onError),$http.get("/api/badges/"+currentBadge+"/applications").success(function(data){$scope.applications=data}).error(onError)}]).controller("appmakerController",["$scope","$rootScope","$timeout",function($scope,$rootScope,$timeout){$scope.audiences=[{title:"students",image:"/img/appmaker/appmaker-hero-blue.svg"},{title:"business",image:"/img/appmaker/appmaker-hero-red.svg"},{title:"friends",image:"/img/appmaker/appmaker-hero-yellow.svg"}],$scope.makes=[{title:"Music App",image:"/img/appmaker/music-app.jpg",remixUrl:"//apps.webmaker.org/"+$scope.lang+"/designer?remix=http://magical-profit-510.webmak.es/app",installUrl:"//magical-profit-510.webmak.es/install",appUrl:"//magical-profit-510.webmak.es/app"},{title:"Chat App",image:"/img/appmaker/chat-app.jpg",remixUrl:"//apps.webmaker.org/"+$scope.lang+"/designer?remix=http://scattered-reading-531.webmak.es/app",installUrl:"//scattered-reading-531.webmak.es/install",appUrl:"//scattered-reading-531.webmak.es/app"},{title:"Fireworks App",image:"/img/appmaker/fireworks-app.jpg",remixUrl:"//apps.webmaker.org/"+$scope.lang+"/designer?remix=http://neat-rate-866.webmak.es/app",installUrl:"//neat-rate-866.webmak.es/install",appUrl:"//neat-rate-866.webmak.es/app"}],$scope.showAudienceTitle=$scope.audiences[0].title,$scope.currentSlideIndex=0;var transitionPromises=[],currentSlideIndex=0;$scope.setActiveSlide=function(active,index){active&&currentSlideIndex!==index&&(currentSlideIndex=index,transitionPromises.length&&transitionPromises.forEach($timeout.cancel),$scope.showAudienceTitle=!1,transitionPromises.push($timeout(function(){$scope.currentSlideIndex=currentSlideIndex},400)),transitionPromises.push($timeout(function(){$scope.showAudienceTitle=$scope.audiences[currentSlideIndex].title},800)))}}]).controller("gogglesController",["$scope","CONFIG","wmAnalytics",function($scope,config,analytics){$scope.gogglesUrl=config.gogglesUrl,$(".goggles-activate-button").click(function(){document.head.appendChild($("<script>").addClass("webxray").attr("src",config.gogglesUrl+"/en-US/webxray.js").attr("data-baseuri",config.gogglesUrl+"/en-US")[0]),analytics.event("Goggles activated")}),$(".goggles-help-button").click(function(){analytics.event("Goggles help button clicked"),this.remove(),$(".goggles-help-toggled").toggleClass("hidden")}),$(".goggles-install-link").click(function(){analytics.event("Goggles install link clicked")}),$(".goggles-bookmark-link").on("dragstart",function(){analytics.event("Goggles bookmark dragged")})}]).controller("feedbackController",["$scope","wmNav",function($scope,wmNav){wmNav.section("info"),wmNav.page("feedback")}]).controller("getinvolvedController",["$scope","wmNav",function($scope,wmNav){wmNav.section("teach"),wmNav.page("getinvolved")}]).controller("mentorController",["$scope","wmNav",function($scope,wmNav){wmNav.section("teach"),wmNav.page("mentor")}]).controller("localebannerController",["$scope","CONFIG","$http","$location",function($scope,config,$http,$location){$http.get("/localeInfo").success(function(localeInfo){$scope.listLang=[],$scope.langmap=config.langmap,localeInfo.otherLangPrefs.map(function(item){-1!==config.supportLang.indexOf(item)&&1!==$scope.listLang.indexOf(item)&&$scope.listLang.length<1&&item.match(/^[a-z]{2}/)&&config.lang.match(/^[a-z]{2}/)&&item.match(/^[a-z]{2}/)[0]!==config.lang.match(/^[a-z]{2}/)[0]&&$scope.listLang.push(item)});var el=document.getElementById("locale-banner");$scope.listLang.length||($scope.bannerBool=!0,el.remove()),$scope.removeBanner=function(){localStorage.setItem("localeBanner",!0),$scope.bannerBool=!0,el.remove()},$scope.acceptRedirect=function(){var href=$location.path(),lang=config.lang,supportedLanguages=config.supportLang;$scope.removeBanner();var matchesLang,matches=href.match(/([a-z]{2,3})([-]([a-zA-Z]{2}))?/);matches&&(matchesLang=matches[1]&&matches[2]?matches[1].toLowerCase()+matches[2].toUpperCase():matches[1].toLowerCase()),$scope.listLang[0]!==lang&&(matches&&matches[0]&&-1!==supportedLanguages.indexOf(matchesLang)?(href=href.replace(matches[0],$scope.listLang[0]),window.location=href):window.location="/"===href?"/"+$scope.listLang[0]:"/"+$scope.listLang[0]+href)},$scope.didYouKnowLocale=localeInfo.didYouKnowLocale[$scope.listLang[0]],$scope.bannerBool=localStorage.getItem("localeBanner")})}]),angular.module("webmakerApp").directive("wmAffix",["$window","$timeout",function($window){return{restrict:"EA",link:function(scope,el,attrs){var elHeight=attrs.offsetHeight,elTop=attrs.offsetTop;$window.addEventListener("scroll",function(){var scrollTop=$(this).scrollTop();scrollTop>=elTop?($("body").css("padding-top",elHeight),el.addClass("navbar-affix-top"),scope.affixed=!0,scope.$apply()):($("body").css("padding-top",0),el.removeClass("navbar-affix-top"),scope.affixed=!1,scope.$apply())},!1)}}}]).directive("a",["$location","$anchorScroll","$route",function($location,$anchorScroll){return{restrict:"E",link:function(scope,el,attrs){attrs.pushState||el.attr("target","_self"),"#"===attrs.href?el.on("click",function(e){e.preventDefault()}):attrs.href&&attrs.href.match(/(^|\s)#([^ ]*)/)?el.on("click",function(e){e.preventDefault(),$location.hash(attrs.href.replace("#","")),scope.$apply(),$anchorScroll()}):window.scrollTo(0,0)}}}]).directive("remixLink",["$window","makeapi",function($window,makeapi){return{restrict:"A",link:function(scope,el,attrs){attrs.$observe("remixLink",function(val){val&&val.length>0&&makeapi.makeapi.id(attrs.remixLink).then(function(err,makes){err&&console.error(err),el.prop("href",makes[0].remixurl)})})}}}]).directive("masonryGallery",["$timeout","$rootScope",function($timeout,$rootScope){return{restrict:"A",scope:{masonryOptions:"="},link:function(scope,element){$rootScope.$on("makeLoad",function(){scope.loaded=scope.loaded?scope.loaded+1:1;var total=$(element).children(".make").length;if(scope.loaded===total){var mason=new window.Masonry(element.context,scope.masonryOptions);mason.layout()}})}}}]).directive("retinaImage",["$window",function($window){"use strict";function renderImage($image,source){$image.attr("src",source)}return{restrict:"A",link:function(scope,el){void 0!==$window.devicePixelRatio&&$window.devicePixelRatio>=1.5?renderImage($(el),$(el).attr("data-src-2x")):renderImage($(el),$(el).attr("data-src-1x"))}}}]).directive("marquee",["$window",function($window){var $=$window.jQuery,Marquee=function(target,options){var defaults,option,self=this;defaults={itemsPerGroup:3,rotationSpeed:5e3,fadeInSpeed:1e3};for(option in options)defaults[option]=options[option]||defaults[option];self.options=defaults,self.$container=$(target),self.$items=self.$container.children(),self.firstVisibleItemIndex=0,self.itemCount=self.$items.length,self.visibleItems=[],self.rotationInterval=null,self.isRotating=!1,self.$items.fadeTo(0,0).hide()};return Marquee.prototype={showGroup:function(firstItemIndex){var self=this,group=[],i=0;for(self.visibleItems.forEach(function(index){self.$items.eq(index).hide()});i<self.options.itemsPerGroup;)firstItemIndex>=self.itemCount&&(firstItemIndex%=self.itemCount),group.push(firstItemIndex),firstItemIndex++,i++;self.visibleItems=group,group.sort(function(a,b){return a>b}),group.forEach(function(itemIndex,i){self.$items.eq(itemIndex).fadeTo(0,0),setTimeout(function(){self.$items.eq(itemIndex).fadeTo(self.options.fadeInSpeed,1)},i*(self.options.fadeInSpeed/4))})},startRotation:function(){function showNextGroup(){self.showGroup(self.visibleItems.length?self.visibleItems[self.visibleItems.length-1]+1:0)}var self=this;self.isRotating=!0,showNextGroup(),self.rotationInterval=setInterval(showNextGroup,self.options.rotationSpeed)},stopRotation:function(){var self=this;clearInterval(self.rotationInterval),self.isRotating=!1}},{restrict:"A",link:function(scope,el){var marquee=new Marquee(el);marquee.startRotation()}}}]).directive("wmArrowTo",function(){return{restrict:"EA",template:'<img class="maker-party-arrow" src="/img/home/maker-party-arrow.svg">'}}).directive("languageSelect",["CONFIG","$timeout","$location",function(config,$timeout,$location){return{restrict:"A",link:function($scope,$element,$attrs){for(var lang,options=[],i=0;i<config.supported_languages.length;i++)lang=config.supported_languages[i],options.push({id:lang,title:config.langmap[lang]?config.langmap[lang].nativeName:lang,english:config.langmap[lang]&&config.langmap[lang].englishName});$timeout(function(){$element.selectize({options:options,labelField:"title",valueField:"id",searchField:["title","english"],onItemAdd:function(selectedLang){if($attrs.redirect){var matchesLang,href=$location.path(),lang=config.lang,supportedLanguages=config.supported_languages,matches=href.match(/([a-z]{2,3})([-]([a-zA-Z]{2}))?/);if(matches&&(matchesLang=matches[1]&&matches[2]?matches[1].toLowerCase()+matches[2].toUpperCase():matches[1].toLowerCase()),selectedLang===lang)return;matches&&matches[0]&&-1!==supportedLanguages.indexOf(matchesLang)?(href=href.replace(matches[0],selectedLang),window.location=href):window.location="/"===href?"/"+selectedLang:"/"+selectedLang+href}}});var selectize=$element[0].selectize;selectize.setValue(config.lang)})}}}]).directive("competencyMediaGen",["$sce",function(){return{restrict:"EA",templateUrl:"/views/partials/competency-media-gen.html"}}]),angular.module("webmakerApp").filter("rfc3339",function(){return function(timestamp){return timestamp?new Date(timestamp).toISOString():void 0}}).filter("decode",function(){return function(tag){return tag=tag||"",decodeURIComponent(tag)}}).filter("urlsToLinks",function(){return function(text){return text.replace(/(https?:\/\/[\S]*)/g,'<a href="$1" target="_blank">$1</a>')}}).filter("openGraphLocale",function(){return function(locale){return locale?locale.replace("-","_"):void 0}}).filter("likesText",function(){return function(likes){if(likes){var likesText;switch(likes.length){case 0:likesText="Like-0";break;case 1:likesText="Like-1";break;default:likesText="Like-n"}return likesText}}}).filter("generateGravatar",function(){return function(hash){var default_avatar="https%3A%2F%2Fstuff.webmaker.org%2Favatars%2Fwebmaker-avatar-44x44.png",default_size=44;return"https://secure.gravatar.com/avatar/"+hash+"?s="+default_size+"&d="+default_avatar}}),angular.module("localization",["ngSanitize"]).factory("localize",["$http","$rootScope","CONFIG",function($http,$rootScope,config){var localize={dictionary:{},url:void 0,resourceFileLoaded:!1,successCallback:function(data){localize.dictionary=data,localize.resourceFileLoaded=!0,$rootScope.$broadcast("localizeResourcesUpdated")},buildUrl:function(){return"/strings/"+config.lang},initLocalizedResources:function(){var url=localize.url||localize.buildUrl();$http({method:"GET",url:url,cache:!1}).success(localize.successCallback).error(function(){var url="/strings/en-US";$http({method:"GET",url:url,cache:!1}).success(localize.successCallback)})},getLocalizedString:function(value){return localize.resourceFileLoaded?localize.dictionary.hasOwnProperty(value)?localize.dictionary[value]:(console.error('i18n unknown key: "'+value+'"'),value):void 0}};return localize.initLocalizedResources(),localize}]).filter("i18n",["localize",function(localize){return function(input){return localize.getLocalizedString(input)}}]).directive("i18n",["localize",function(localize){var i18nDirective={restrict:"A",updateText:function(elm,token){var values=token.split("|");if(values.length>=1){var tag=localize.getLocalizedString(values[0]);if(null!==tag&&void 0!==tag&&""!==tag){if(values.length>1)for(var index=1;index<values.length;index++){var target="{"+(index-1)+"}";tag=tag.replace(target,values[index])}elm.text(tag)}}},link:function(scope,elm,attrs){scope.$on("localizeResourcesUpdated",function(){i18nDirective.updateText(elm,attrs.i18n)}),attrs.$observe("i18n",function(){i18nDirective.updateText(elm,attrs.i18n)})}};return i18nDirective}]).directive("bindUnsafeHtml",["$compile",function($compile){return function(scope,element,attrs){scope.$watch(function(scope){return scope.$eval(attrs.bindUnsafeHtml)},function(value){element.html(value),$compile(element.contents())(scope)})}}]).directive("i18nAttr",["localize",function(localize){var i18NAttrDirective={restrict:"A",updateText:function(elm,token){var values=token.split("|"),tag=localize.getLocalizedString(values[0]);if(null!==tag&&void 0!==tag&&""!==tag){if(values.length>2)for(var index=2;index<values.length;index++){var target="{"+(index-2)+"}";tag=tag.replace(target,values[index])}elm.attr(values[1],tag)}},link:function(scope,elm,attrs){scope.$on("localizeResourcesUpdated",function(){i18NAttrDirective.updateText(elm,attrs.i18nAttr)}),attrs.$observe("i18nAttr",function(value){i18NAttrDirective.updateText(elm,value)})}};return i18NAttrDirective}]),angular.module("webmakerApp.services",[]).constant("CONFIG",window.angularConfig).filter("decodeURI",function(){return function(input){return decodeURIComponent(input)}}).factory("wmNav",["$rootScope","CONFIG",function($rootScope){var activePage="",activeSection="";return{nav:{sections:[{id:"explore",url:"explore",title:"Explore",icon:"random"},{id:"tools",url:"tools",title:"Tools",icon:"hand-o-up",pushState:!0},{id:"events",url:"events",title:"Events",icon:"map-marker"},{id:"teach",title:"Teach",url:"mentor",icon:"book",pushState:!0,pages:[{id:"resources",title:"Web Literacy",url:"resources",pushState:!0},{id:"badges",title:"Badges",url:"_badges"},{id:"hive",title:"Hive",url:"_hive",doNotTranslate:!0}]}]},page:function(page){return(page||""===page)&&(activePage=page,$rootScope.currentPageId="page-"+page),activePage},section:function(section){return(section||""===section)&&(activeSection=section,$rootScope.currentSectionId=section),activeSection}}}]).factory("weblit",["$window",function($window){return new $window.WebLiteracyClient}]).factory("wmAnalytics",["$window",function($window){return $window.analytics}]).factory("makeapi",["$q","$window",function($q,$window){var makeapi=new $window.Make({apiURL:"https://makeapi.webmaker.org"});return{makeapi:makeapi,tags:function(tags){var deferred=$q.defer();return makeapi.sortByField("likes").limit(4).find({tags:[{tags:tags}],orderBy:"likes"}).then(function(err,makes){err?deferred.reject(err):deferred.resolve(makes)}),deferred.promise}}}]);var module=module||void 0;
!function(module){var permissionsModel=function(options){var permissions={"webmaker-super-mentor":{issue:3,applications:3,viewInstances:3,"delete":3},"webmaker-mentor":{issue:2,applications:2,viewInstances:2,"delete":3},"*":{issue:1,applications:1,viewInstances:1,"delete":3}};if(!options)throw new Error("You must pass an options object into permissionsModel");if(!options.badge||!options.action)throw new Error("You must pass an options object with badge and action into permissionsModel");if(!options.user)return!1;var level,badge=options.badge,user=options.user,action=options.action;level=user.isAdmin?3:user.isSuperMentor?2:user.isMentor?1:0;var badgeModel=permissions[badge]||permissions["*"];return level>=badgeModel[action]?!0:!1};"undefined"!=typeof module&&module.exports?module.exports=permissionsModel:"function"==typeof define&&define.amd?define(function(){return permissionsModel}):window.badgesPermissionsModel=permissionsModel}(module);